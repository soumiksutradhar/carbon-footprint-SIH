<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Your Results</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
		body {
			font-family: 'Poppins', sans-serif;
			min-height: 100vh;
			margin: 0;
			display: flex;
			flex-direction: column;
			justify-content: center;
			color: rgba(255,255,255,0.95);
			text-shadow: 0 0 5px rgba(0,0,0,0.3);
			overflow-x: hidden;
			position: relative;
			background: linear-gradient(135deg, #0b3d91, #1c6dd0);
		}

		.hero {
			text-align: center;
			margin-bottom: 30px;
			position: relative;
			z-index: 2;
		}
		.hero h1 {
			font-size: 3rem;
			font-weight: 600;
			background: linear-gradient(270deg, #00f0ff, #ff6cf2, #ffeb00, #00f0ff);
			background-size: 600% 600%;
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			text-shadow:
				0 0 3px rgba(0,240,255,0.6),
				0 0 5px rgba(0,240,255,0.5),
				0 0 10px rgba(255,108,242,0.4),
				0 0 15px rgba(255,108,242,0.3);
			animation: gradientShift 18s ease infinite;
		}
		@keyframes gradientShift {
			0% { background-position: 0% 50%; }
			50% { background-position: 100% 50%; }
			100% { background-position: 0% 50%; }
		}

		.card {
			background: rgba(0, 0, 0, 0.3);
			backdrop-filter: blur(15px);
			-webkit-backdrop-filter: blur(15px);
			border: 1px solid rgba(255,255,255,0.2);
			border-radius: 20px;
			padding: 30px;
			color: white;
			position: relative;
			z-index: 2;
			box-shadow: inset 0 0 15px rgba(0,0,0,0.2), 0 8px 30px rgba(0,0,0,0.3);
		}

		.btn-custom {
			background: rgba(0,120,215,0.6);
			color: white;
			border-radius: 10px;
			font-weight: 600;
			border: 1px solid rgba(255,255,255,0.3);
			backdrop-filter: blur(5px);
			transition: all 0.3s ease;
		}
		.btn-custom:hover {
			background: rgba(0,150,255,0.7);
			transform: scale(1.05);
			box-shadow: 0 0 15px rgba(0,150,255,0.5);
		}

		#ember-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 0;
			overflow: hidden;
		}
		.ember {
			position: absolute;
			border-radius: 50%;
			pointer-events: none;
			width: 4px;
			height: 4px;
			opacity: 0.8;
		}
	</style>
</head>
<body>
	<div id="ember-container"></div>

	<div class="container hero">
		<h1>Your Daily Carbon Footprint</h1>
	</div>

	<div class="container d-flex justify-content-center">
		<div class="col-md-8">
			<div class="card">
				<h2 class="text-center">{{ total }} kg COâ‚‚</h2>
				<p class="text-center"><strong>Badge:</strong> {{ badge }}</p>

				<canvas id="chart" class="my-4"></canvas>
				<script>
					const ctx = document.getElementById('chart');
					new Chart(ctx, {
						type: 'doughnut',
						data: {
							labels: ['Transport', 'Electricity', 'Food'],
							datasets: [{
								data: [{{ transport }}, {{ electricity }}, {{ food }}],
								backgroundColor: ['#EF5350','#42A5F5','#66BB6A']
							}]
						},
						options: {
							plugins: { legend: { position: 'bottom' } }
						}
					});
				</script>

				<div class="mt-4">
					<h4>Suggestions for You</h4>
					<ul class="list-group">
						{% for s in suggestions %}
							<li class="list-group-item">{{ s }}</li>
						{% endfor %}
					</ul>
				</div>

				<div class="mt-4">
					<h4>Comparison</h4>
					<p>Your footprint: <strong>{{ total }} kg</strong> vs. Average: <strong>{{ average }} kg</strong></p>
					<div class="progress">
						<div class="progress-bar bg-success" role="progressbar"
							style="width: {{ (total/average)*100 if average > 0 else 0 }}%">
							You
						</div>
					</div>
				</div>

				<div class="text-center mt-4">
					<a href="/" class="btn btn-custom">Try Again</a>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Smooth dynamic gradient
		const gradientStops = [
			[{r:11,g:61,b:145}, {r:28,g:109,b:208}],
			[{r:90,g:50,b:160}, {r:130,g:60,b:200}],
			[{r:30,g:70,b:180}, {r:100,g:80,b:220}],
			[{r:11,g:61,b:145}, {r:28,g:109,b:208}]
		];
		let t = 0, step = 0;
		function lerpColor(c1, c2, t){
			return {
				r: Math.round(c1.r + (c2.r-c1.r)*t),
				g: Math.round(c1.g + (c2.g-c1.g)*t),
				b: Math.round(c1.b + (c2.b-c1.b)*t)
			};
		}
		function updateGradient(){
			let cStart = lerpColor(gradientStops[step][0], gradientStops[(step+1)%gradientStops.length][0], t);
			let cEnd = lerpColor(gradientStops[step][1], gradientStops[(step+1)%gradientStops.length][1], t);
			document.body.style.background = `linear-gradient(135deg, rgb(${cStart.r},${cStart.g},${cStart.b}), rgb(${cEnd.r},${cEnd.g},${cEnd.b}))`;
			t += 0.001;
			if(t>=1){ t=0; step = (step+1)%gradientStops.length; }
			requestAnimationFrame(updateGradient);
		}
		requestAnimationFrame(updateGradient);

		// Ember & smoke particles
		const emberContainer = document.getElementById('ember-container');
		const embers = [];
		const smokeParticles = [];
		const numEmbers = 50;
		const numSmoke = 150;
		const windX = 0.3;
		const pageWidth = window.innerWidth;

		// Create embers
		for (let i = 0; i < numEmbers; i++) {
			const ember = document.createElement('div');
			ember.classList.add('ember');
			emberContainer.appendChild(ember);

			const size = Math.random() * 4 + 2;
			ember.style.width = size + 'px';
			ember.style.height = size + 'px';

			embers.push({
				el: ember,
				x: Math.random() * pageWidth,
				y: window.innerHeight + Math.random() * 200,
				vx: (Math.random() - 0.5) * 0.5 + windX,
				vy: -(Math.random() * 1 + 0.5)
			});

			const r = Math.floor(200 + Math.random() * 55);
			const g = Math.floor(150 + Math.random() * 55);
			const b = Math.floor(50 + Math.random() * 50);
			ember.style.background = `rgba(${r},${g},${b},0.8)`;
			ember.style.boxShadow = `0 0 10px rgba(${r},${g},${b},0.8)`;
		}

		// Create smoke
		for (let i = 0; i < numSmoke; i++) {
			const smoke = document.createElement('div');
			smoke.classList.add('ember');
			emberContainer.appendChild(smoke);

			const size = Math.random() * 2 + 1;
			smoke.style.width = size + 'px';
			smoke.style.height = size + 'px';
			smoke.style.background = `rgba(200,200,200,0.08)`;
			smoke.style.boxShadow = `0 0 5px rgba(200,200,200,0.05)`;

			smokeParticles.push({
				el: smoke,
				x: Math.random() * pageWidth,
				y: window.innerHeight + Math.random() * 200,
				vx: (Math.random() - 0.5) * 0.2 + windX/2,
				vy: -(Math.random() * 0.3 + 0.1)
			});
		}

		// Animate particles
		function animateParticles() {
			for (const e of embers) {
				e.x += e.vx;
				e.y += e.vy;

				if (e.y < -10 || e.x < -10 || e.x > pageWidth + 10) {
					e.x = Math.random() * pageWidth;
					e.y = window.innerHeight + 10;
					e.vx = (Math.random() - 0.5) * 0.5 + windX;
					e.vy = -(Math.random() * 1 + 0.5);
				}
				e.el.style.transform = `translate(${e.x}px, ${e.y}px)`;
			}

			for (const s of smokeParticles) {
				s.x += s.vx;
				s.y += s.vy;

				if (s.y < -10 || s.x < -10 || s.x > pageWidth + 10) {
					s.x = Math.random() * pageWidth;
					s.y = window.innerHeight + 10;
					s.vx = (Math.random() - 0.5) * 0.2 + windX / 2;
					s.vy = -(Math.random() * 0.3 + 0.1);
				}
				s.el.style.transform = `translate(${s.x}px, ${s.y}px)`;
			}

			requestAnimationFrame(animateParticles);
		}
		requestAnimationFrame(animateParticles);
	</script>
</body>
</html>

